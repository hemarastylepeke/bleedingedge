{% extends 'core/base.html' %}
{% load static %}

{% block title %}Pantry Dashboard - PantryChef{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-green-50 to-blue-50 py-8">
    <div class="container mx-auto px-4 max-w-7xl">
        <!-- Header Section -->
        <div class="mb-8">
            <h1 class="text-3xl md:text-4xl text-center font-bold text-gray-800 mb-2">Dashboard Overview</h1>
            <p class="text-gray-600 text-center">Welcome back! Here's your pantry summary.</p>
        </div>

        <!-- Quick Actions -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <a href="{% url 'create_shopping_list' %}" class="bg-white rounded-xl shadow p-4 text-center hover:shadow-lg transition-shadow border border-green-200">
                <div class="bg-green-100 w-12 h-12 rounded-lg flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-robot text-green-600 text-xl"></i>
                </div>
                <span class="text-sm font-medium text-gray-800">AI Shopping</span>
            </a>
            <a href="{% url 'create_recipe' %}" class="bg-white rounded-xl shadow p-4 text-center hover:shadow-lg transition-shadow border border-blue-200">
                <div class="bg-blue-100 w-12 h-12 rounded-lg flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-magic text-blue-600 text-xl"></i>
                </div>
                <span class="text-sm font-medium text-gray-800">AI Recipe</span>
            </a>
            <a href="{% url 'pantry_list' %}" class="bg-white rounded-xl shadow p-4 text-center hover:shadow-lg transition-shadow border border-purple-200">
                <div class="bg-purple-100 w-12 h-12 rounded-lg flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-shopping-basket text-purple-600 text-xl"></i>
                </div>
                <span class="text-sm font-medium text-gray-800">View Pantry</span>
            </a>
            <a href="{% url 'budget_list' %}" class="bg-white rounded-xl shadow p-4 text-center hover:shadow-lg transition-shadow border border-amber-200">
                <div class="bg-amber-100 w-12 h-12 rounded-lg flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-wallet text-amber-600 text-xl"></i>
                </div>
                <span class="text-sm font-medium text-gray-800">Budget</span>
            </a>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Pantry Items</p>
                        <h3 class="text-2xl font-bold mt-2 text-gray-800">{{ total_items }}</h3>
                    </div>
                    <div class="bg-green-100 p-3 rounded-lg">
                        <i class="fas fa-egg text-green-600 text-xl"></i>
                    </div>
                </div>
                <p class="text-green-600 text-sm mt-4 font-medium">
                    <i class="fas fa-arrow-up mr-1"></i>{{ pantry_items.count }} active items
                </p>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-amber-500">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Food Waste Saved</p>
                        <h3 class="text-2xl font-bold mt-2 text-gray-800">£{{ waste_savings|floatformat:2|default:"0.00" }}</h3>
                    </div>
                    <div class="bg-amber-100 p-3 rounded-lg">
                        <i class="fas fa-pound-sign text-amber-600 text-xl"></i>
                    </div>
                </div>
                <p class="text-amber-600 text-sm mt-4 font-medium">
                    <i class="fas fa-chart-line mr-1"></i>{{ waste_reduction_percentage|default:"0" }}% reduction
                </p>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Recipes Created</p>
                        <h3 class="text-2xl font-bold mt-2 text-gray-800">{{ recipes_created|default:"0" }}</h3>
                    </div>
                    <div class="bg-blue-100 p-3 rounded-lg">
                        <i class="fas fa-book text-blue-600 text-xl"></i>
                    </div>
                </div>
                <p class="text-blue-600 text-sm mt-4 font-medium">
                    <i class="fas fa-check mr-1"></i>{{ pantry_utilization|default:"0" }}% pantry used
                </p>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Budget Status</p>
                        <h3 class="text-2xl font-bold mt-2 text-gray-800">
                            {% if current_budget %}
                                £{{ current_budget.amount_spent|floatformat:2|default:"0.00" }}/£{{ current_budget.amount|floatformat:2 }}
                            {% else %}
                                £0.00/£0.00
                            {% endif %}
                        </h3>
                    </div>
                    <div class="bg-purple-100 p-3 rounded-lg">
                        <i class="fas fa-wallet text-purple-600 text-xl"></i>
                    </div>
                </div>
                <p class="text-purple-600 text-sm mt-4 font-medium">
                    <i class="fas fa-chart-pie mr-1"></i>{{ budget_percentage|default:"0" }}% of budget
                </p>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Expiring Soon -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-800">Items Expiring Soon</h3>
                        <a href="{% url 'pantry_list' %}" class="text-green-600 text-sm font-medium hover:text-green-700">View All</a>
                    </div>
                    <div class="space-y-4">
                        {% for item in expiring_soon %}
                        <div class="flex items-center p-4 border rounded-lg {% if item.days_until_expiry <= 1 %}border-red-200 bg-red-50{% elif item.days_until_expiry <= 3 %}border-amber-200 bg-amber-50{% else %}border-gray-200 bg-gray-50{% endif %} hover:shadow-md transition-shadow">
                            <div class="{% if item.days_until_expiry <= 1 %}bg-red-100 text-red-600{% elif item.days_until_expiry <= 3 %}bg-amber-100 text-amber-600{% else %}bg-gray-100 text-gray-600{% endif %} p-3 rounded-lg mr-4">
                                <i class="fas {% if item.days_until_expiry <= 1 %}fa-exclamation-triangle{% else %}fa-clock{% endif %}"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-medium text-gray-800">{{ item.name }}</h4>
                                <p class="text-gray-600 text-sm">
                                    Expired
                                </p>
                            </div>
                            <div class="flex space-x-2">
                                <a href="{% url 'create_recipe' %}" class="bg-green-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-green-700 transition-colors font-medium">Use Now</a>
                                <a href="{% url 'edit_pantry_item' item.id %}" class="bg-gray-200 text-gray-700 px-3 py-2 rounded-lg text-sm hover:bg-gray-300 transition-colors font-medium">Edit</a>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-check-circle text-4xl text-green-400 mb-3"></i>
                            <p class="text-gray-600">No items expiring soon! Great job managing your pantry.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Recent Consumption -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-800">Recent Consumption</h3>
                        <a href="{% url 'shopping_list_list' %}" class="text-green-600 text-sm font-medium hover:text-green-700">View All</a>
                    </div>
                    <div class="space-y-4">
                        {% for consumption in recent_consumption %}
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg bg-gray-50 hover:shadow-md transition-shadow">
                            <div class="bg-green-100 p-3 rounded-lg mr-4">
                                <i class="fas fa-shopping-bag text-green-600"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-medium text-gray-800">Shopping List Completed</h4>
                                <p class="text-gray-600 text-sm">
                                    {{ consumption.items_count }} items • £{{ consumption.total_cost|floatformat:2|default:"0.00" }} • {{ consumption.date|timesince }} ago
                                </p>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-shopping-cart text-4xl text-gray-300 mb-3"></i>
                            <p class="text-gray-600 mb-4">No recent shopping activity.</p>
                            <a href="{% url 'create_shopping_list' %}" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium">Create Shopping List</a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="space-y-6">
                <!-- Recipe Suggestions -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-800">Recipe Suggestions</h3>
                        <a href="{% url 'recipe_list' %}" class="text-green-600 text-sm font-medium hover:text-green-700">View All</a>
                    </div>
                    <div class="space-y-4">
                        {% for recipe in recipe_suggestions %}
                        <div class="border border-gray-200 rounded-lg p-4 hover:border-green-300 hover:shadow-md transition-all bg-white">
                            <div class="flex justify-between items-start mb-3">
                                <h4 class="font-medium text-gray-800">{{ recipe.name }}</h4>
                                <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full font-semibold">{{ recipe.match_percentage }}% Match</span>
                            </div>
                            <p class="text-gray-600 text-sm mb-3">
                                Uses: 
                                {% for ingredient in recipe.matching_ingredients %}
                                    <span class="bg-gray-100 text-gray-700 px-2 py-1 rounded text-xs">{{ ingredient }}</span>
                                {% endfor %}
                            </p>
                            <div class="flex justify-between text-sm text-gray-600">
                                <span><i class="fas fa-clock mr-1"></i>{{ recipe.prep_time }} min</span>
                                <span><i class="fas fa-fire mr-1"></i>{{ recipe.calories }} cal</span>
                                <span><i class="fas fa-star mr-1 text-amber-400"></i>{{ recipe.rating }}</span>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center py-6 text-gray-500">
                            <i class="fas fa-utensils text-3xl text-gray-300 mb-3"></i>
                            <p class="text-gray-600 text-sm mb-4">Add more items to get recipe suggestions</p>
                            <a href="{% url 'add_pantry_item' %}" class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-green-700 transition-colors font-medium">Add Items</a>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Waste Reduction Tips -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-6">Waste Reduction Tips</h3>
                    <div class="space-y-4">
                        {% for tip in waste_tips %}
                        <div class="flex items-start">
                            <div class="bg-green-100 p-2 rounded-lg mr-4 mt-1">
                                <i class="fas fa-lightbulb text-green-600 text-sm"></i>
                            </div>
                            <p class="text-gray-700 text-sm leading-relaxed">{{ tip }}</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.hover-lift:hover {
    transform: translateY(-2px);
    transition: transform 0.2s ease;
}

@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
    70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
    100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
}

.pulse-warning {
    animation: pulse 2s infinite;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add hover effects to cards
    document.querySelectorAll('.bg-white.rounded-xl').forEach(card => {
        card.classList.add('hover-lift');
    });

    // Add pulse animation to critical expiring items
    document.querySelectorAll('.border-red-200').forEach(item => {
        item.classList.add('pulse-warning');
    });

    // Auto-refresh dashboard every 5 minutes
    setTimeout(() => {
        window.location.reload();
    }, 300000);
});
</script>
{% endblock %}